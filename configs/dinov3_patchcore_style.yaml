# DINOv3 PatchCore-style 图像级别异常检测配置文件
# 使用 patch-level features (pixel tokens) 和 PatchCore 逻辑（1-NN + max pooling）

model:
  name: dinov3_image_level  # 使用相同的模型类
  detection_mode: patchcore_style  # 检测模式：patchcore_style 或 image_level (默认)
  dino_model_name: dinov3_huge  # DINOv3 model name (dinov3_base, dinov3_large, etc.)
  model_path: null  # local model path (if provided, don't download automatically, if null, download from timm)
  
  num_centers: 500000           # maximum number of samples in memory bank
  buffer_size: 25000000         # maximum size of buffer (batch loading strategy)
  num_neighbors: 1             # number of neighbors for K-NN (not used in patchcore_style mode)

data:
  train_data_path: ./data/train    # training data path
  val_data_path: null              # validation data path (optional)
  
  batch_size: 8                    # batch size (reduced for dinov3_huge to avoid OOM)
  num_workers: 8                   # number of workers for data loader
  image_size: 512                   # image size (can reduce to 384 or 256 if OOM)
  
  # Data augmentation (only applied during training)
  use_augmentation: true           # enable data augmentation
  # Augmentation options:
  # - RandomCrop: Random crop from slightly larger image (1.1x size)
  # - RandomHorizontalFlip: Random horizontal flip (p=0.5)
  # - RandomVerticalFlip: Random vertical flip (p=0.3)
  # - ColorJitter: Random color jitter (brightness=0.2, contrast=0.2, saturation=0.2, hue=0.1)
  # - RandomRotation: Random rotation (±10 degrees)
  # - RandomErasing: Random erasing (p=0.1, scale=(0.02, 0.1))
  
  data_format: custom_mvtec        # data format (custom_mvtec, mvtec, etc.)
  normal_dir: train/good           # normal sample directory (for Folder format)

training:
  sampling_ratio: null             # sampling ratio (if null, use num_centers)
  device: cuda                     # device (cuda, cpu)
  device_id: 0                     # GPU device ID

output:
  checkpoint_dir: ./checkpoints    # checkpoint save directory
  results_dir: ./results           # results save directory
  log_dir: ./logs                  # log save directory

misc:
  seed: 42                         # random seed
  verbose: true                    # verbose
